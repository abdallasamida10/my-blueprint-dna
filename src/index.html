<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBlueprint | Genomic Intelligence</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- PDF Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        blueprint: { 950: '#020617', 900: '#0f172a', 800: '#1e293b', 700: '#334155', 500: '#14b8a6', 400: '#2dd4bf', 300: '#5eead4' }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(0, 0, 0, 0.37)',
                        'glow': '0 0 20px rgba(20, 184, 166, 0.15)',
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: { 'spin-slow': 'spin 3s linear infinite' }
                }
            }
        }
    </script>

    <style>
        body {
            background: radial-gradient(circle at top left, #1e293b 0%, #0f172a 40%, #020617 100%);
            background-attachment: fixed;
            color: #f8fafc;
        }

        .dna-loader {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            border-radius: 2px;
        }

        .dna-loader::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 30%;
            background: #2dd4bf;
            box-shadow: 0 0 10px #2dd4bf;
            animation: load 1.5s infinite ease-in-out;
            border-radius: 2px;
        }

        @keyframes load {
            0% {
                left: -30%;
            }

            100% {
                left: 100%;
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- ICONS ---
        const Icons = {
            Dna: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 15c6.667-6 13.333 0 20-6" /><path d="M9 22c1.798-1.998 2.518-3.995 2.807-5.993" /><path d="M15 2c-1.798 1.998-2.518 3.995-2.807 5.993" /><path d="M17 6l-2.5-2.5" /><path d="M14 8l-1-1" /><path d="M7 18l2.5 2.5" /><path d="M3.5 14.5l-1 1" /><path d="M20 9l2.5 2.5" /><path d="M6.5 12.5l1 1" /><path d="M16.5 15.5l1 1" /><path d="M10 16l1.5 1.5" /></svg>,
            LayoutGrid: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="7" x="3" y="3" rx="1" /><rect width="7" height="7" x="14" y="3" rx="1" /><rect width="7" height="7" x="14" y="14" rx="1" /><rect width="7" height="7" x="3" y="14" rx="1" /></svg>,
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2" /></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M10 9H8" /><path d="M16 13H8" /><path d="M16 17H8" /></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></svg>,
            LogOut: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" x2="9" y1="12" y2="12" /></svg>,
            UserCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /><circle cx="12" cy="10" r="3" /><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662" /></svg>,
            UploadCloud: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" /><path d="M12 12v9" /><path d="m16 16-4-4-4 4" /></svg>,
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14H4z" /></svg>,
            HeartPulse: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /><path d="M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27" /></svg>,
            Brain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z" /><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z" /><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4" /><path d="M17.599 6.5a3 3 0 0 0 .399-1.375" /><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5" /><path d="M3.477 10.896a4 4 0 0 1 .585-.396" /><path d="M19.938 10.5a4 4 0 0 1 .585.396" /><path d="M6 18a4 4 0 0 1-1.97-3.284" /><path d="M17.97 14.716A4 4 0 0 1 16 18" /></svg>,
            AlertTriangle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6" /></svg>,
            CheckCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><path d="M22 4 12 14.01l-3-3" /></svg>,
            File: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /></svg>,
            Menu: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>,
            Search: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></svg>
        };

        // --- COMPONENTS ---
        const GlassCard = ({ children, className = "", title, subtitle, action, onClick, noPadding }) => {
            return (
                <div onClick={onClick} className={`relative overflow-hidden group bg-white/[0.03] backdrop-blur-xl border border-white/10 rounded-2xl shadow-glass hover:shadow-glow hover:border-blueprint-500/30 hover:bg-white/[0.05] transition-all duration-300 ease-out flex flex-col ${onClick ? 'cursor-pointer' : ''} ${className}`}>
                    <div className="absolute inset-0 bg-gradient-to-tr from-white/0 via-white/0 to-white/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none" />
                    {(title || action) && (
                        <div className="relative z-10 flex justify-between items-center p-6 pb-2">
                            <div>
                                {title && <h3 className="text-lg font-bold text-white tracking-tight">{title}</h3>}
                                {subtitle && <p className="text-xs font-medium text-blueprint-300 uppercase tracking-wider mt-1">{subtitle}</p>}
                            </div>
                            {action && <div>{action}</div>}
                        </div>
                    )}
                    <div className={`relative z-10 h-full flex flex-col ${noPadding ? '' : 'p-6 pt-2'}`}>{children}</div>
                </div>
            );
        };

        const MobileHeader = ({ onMenuClick }) => {
            return (
                <div className="md:hidden fixed top-0 left-0 right-0 h-16 bg-blueprint-950 backdrop-blur-md border-b border-white/10 flex items-center justify-between px-4 z-40">
                    <div className="flex items-center" onClick={onMenuClick}>
                        <div className="p-1.5 bg-gradient-to-br from-blueprint-500 to-teal-600 rounded-lg shadow-glow mr-3"><Icons.Dna className="w-5 h-5 text-white" /></div>
                        <h1 className="text-lg tracking-tighter text-white leading-none"><span className="font-light text-blueprint-300/90">My</span><span className="font-bold">Blueprint</span></h1>
                    </div>
                    <button onClick={onMenuClick} className="p-2 text-gray-300 hover:text-white hover:bg-white/10 rounded-lg"><Icons.Menu className="w-6 h-6" /></button>
                </div>
            );
        };

        const Sidebar = ({ activeTab, setActiveTab, isOpen, setIsOpen }) => {
            const menuItems = [
                { id: 'overview', icon: Icons.LayoutGrid, label: "Overview" },
                { id: 'genome', icon: Icons.Dna, label: "My Genome" },
                { id: 'risks', icon: Icons.Activity, label: "Health Risks" },
                { id: 'reports', icon: Icons.FileText, label: "Reports" },
            ];
            const handleItemClick = (id) => { setActiveTab(id); setIsOpen(false); };

            return (
                <>
                    <div className={`md:hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-40 transition-opacity duration-300 ${isOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`} onClick={() => setIsOpen(false)} />
                    <aside className={`fixed left-0 top-0 h-screen z-50 flex flex-col justify-between py-8 border-r border-white/5 bg-blueprint-900/90 backdrop-blur-xl transition-all duration-300 ease-[cubic-bezier(0.25,0.1,0.25,1.0)] shadow-[0_0_50px_rgba(0,0,0,0.5)] md:translate-x-0 ${isOpen ? 'md:w-80' : 'md:w-20'} w-80 ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        <div className={`flex items-center ${isOpen ? 'px-8 justify-start' : 'px-0 justify-center'} mb-12 cursor-pointer group relative w-full`} onClick={() => setIsOpen(!isOpen)} title="Toggle Menu">
                            <div className="relative flex-shrink-0 flex items-center justify-center">
                                <div className="w-12 h-12 bg-gradient-to-br from-blueprint-500 to-teal-600 rounded-xl shadow-glow group-hover:shadow-glow-hover transition-all flex items-center justify-center"><Icons.Dna className="w-6 h-6 text-white" /></div>
                                <div className="md:hidden absolute -right-12 top-1 p-1 bg-white/10 rounded-full" onClick={(e) => { e.stopPropagation(); setIsOpen(false); }}><Icons.X className="w-5 h-5 text-white" /></div>
                            </div>
                            <div className={`ml-4 overflow-hidden transition-all duration-300 ${isOpen ? 'opacity-100 w-auto' : 'opacity-0 w-0'}`}>
                                <h1 className="text-2xl tracking-tighter text-white leading-none whitespace-nowrap"><span className="font-light text-blueprint-300/90">My</span><span className="font-bold">Blueprint</span></h1>
                                <p className="text-[10px] uppercase tracking-[0.2em] text-gray-500 font-semibold mt-1.5 ml-0.5 whitespace-nowrap">Genomic Intelligence</p>
                            </div>
                        </div>
                        <nav className="flex-1 px-4 space-y-2 overflow-hidden w-full flex flex-col items-center">
                            {menuItems.map((item) => {
                                const active = activeTab === item.id;
                                return (
                                    <button key={item.id} onClick={() => handleItemClick(item.id)} className={`h-12 flex items-center rounded-xl transition-all duration-200 group relative overflow-hidden whitespace-nowrap ${active ? 'bg-blueprint-500/10 text-blueprint-300 shadow-[0_0_20px_rgba(20,184,166,0.1)] border border-blueprint-500/20' : 'text-gray-400 hover:bg-white/5 hover:text-white'} ${isOpen ? 'w-full px-4 justify-start' : 'w-12 justify-center px-0'}`} title={!isOpen ? item.label : ''}>
                                        <item.icon className={`w-5 h-5 relative z-10 flex-shrink-0 ${active ? 'text-blueprint-400' : 'group-hover:text-white'}`} />
                                        <span className={`ml-4 font-medium relative z-10 transition-all duration-300 ${isOpen ? 'opacity-100 w-auto' : 'opacity-0 w-0 overflow-hidden absolute left-10'}`}>{item.label}</span>
                                        {active && (<div className={`absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-blueprint-400 rounded-r-full shadow-[0_0_10px_#2dd4bf] transition-all duration-300 ${isOpen ? 'opacity-100' : 'opacity-0'}`} />)}
                                    </button>
                                );
                            })}
                        </nav>
                        <div className="px-4 space-y-2 overflow-hidden w-full flex flex-col items-center">
                            <button className={`h-12 flex items-center text-gray-400 hover:text-white hover:bg-white/5 rounded-xl transition-all ${isOpen ? 'w-full px-4 justify-start' : 'w-12 justify-center px-0'}`}>
                                <Icons.Settings className="w-5 h-5 flex-shrink-0" />
                                <span className={`ml-4 font-medium whitespace-nowrap transition-all duration-300 ${isOpen ? 'opacity-100 w-auto' : 'opacity-0 w-0 overflow-hidden absolute left-10'}`}>Settings</span>
                            </button>
                            <div className={`mt-4 pt-4 border-t border-white/5 transition-all duration-300 w-full ${isOpen ? 'opacity-100' : 'opacity-0 hidden'}`}>
                                {isOpen && (
                                    <button className="w-full flex items-center p-2 hover:bg-white/5 rounded-xl transition-all group">
                                        <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-purple-500 to-blue-500 flex items-center justify-center shadow-lg group-hover:shadow-purple-500/30 transition-all flex-shrink-0"><Icons.UserCircle className="w-6 h-6 text-white" /></div>
                                        <div className="ml-3 text-left overflow-hidden"><p className="text-sm font-medium text-white truncate">Alex Doe</p><p className="text-xs text-gray-500 truncate">Premium Member</p></div>
                                        <Icons.LogOut className="w-4 h-4 ml-auto text-gray-500 hover:text-red-400 transition-colors flex-shrink-0" />
                                    </button>
                                )}
                            </div>
                        </div>
                    </aside>
                </>
            );
        };

        // --- GENOME BROWSER COMPONENT ---
        const GenomeBrowser = ({ data }) => {
            const [search, setSearch] = React.useState('');

            // Use real data if available, else fallback or empty
            const rawData = React.useMemo(() => {
                if (data && data.genome_sample) {
                    return data.genome_sample.map(r => ({
                        rsid: r.rsid || 'Unknown',
                        chrom: r.chromosome || '-',
                        pos: r.position || '-',
                        geno: r.genotype || '-',
                        trait: '-'
                    }));
                }
                // Fallback to risks if no sample (shouldn't happen with new backend)
                if (data && data.risk_list) {
                    return data.risk_list.map(r => ({
                        rsid: r.link ? (r.link.split('=')[1] || 'Unknown') : 'Unknown',
                        chrom: '-',
                        pos: '-',
                        geno: '-',
                        trait: r.variant || 'Unknown'
                    }));
                }
                return [];
            }, [data]);

            const filtered = rawData.filter(r => r.rsid.toLowerCase().includes(search.toLowerCase()));

            return (
                <div className="space-y-6 pb-20">
                    <div className="flex justify-between items-end">
                        <div>
                            <h2 className="text-3xl font-bold text-white">Genome Browser</h2>
                            <p className="text-gray-400">Explore your verified DNA data.</p>
                        </div>
                        <div className="relative">
                            <input
                                type="text"
                                placeholder="Search RSID..."
                                className="pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-xl text-white focus:outline-none focus:border-blueprint-500 w-64 transition-all"
                                value={search}
                                onChange={(e) => setSearch(e.target.value)}
                            />
                            <Icons.Search className="absolute left-3 top-2.5 w-4 h-4 text-gray-400" />
                        </div>
                    </div>

                    <GlassCard noPadding className="overflow-hidden">
                        {filtered.length > 0 ? (
                            <div className="overflow-x-auto">
                                <table className="w-full text-left text-sm text-gray-400 min-w-[800px]">
                                    <thead className="bg-white/5 text-white uppercase text-xs font-bold">
                                        <tr>
                                            <th className="px-6 py-4">RSID</th>
                                            <th className="px-6 py-4">Chromosome</th>
                                            <th className="px-6 py-4">Position</th>
                                            <th className="px-6 py-4">Genotype</th>
                                            <th className="px-6 py-4">Associated Trait</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-white/5">
                                        {filtered.map((row, i) => (
                                            <tr key={i} className="hover:bg-white/5 transition-colors">
                                                <td className="px-6 py-4 font-mono text-blueprint-300">{row.rsid}</td>
                                                <td className="px-6 py-4">{row.chrom}</td>
                                                <td className="px-6 py-4">{row.pos}</td>
                                                <td className="px-6 py-4"><span className="px-2 py-1 rounded bg-white/10 text-white font-bold">{row.geno}</span></td>
                                                <td className="px-6 py-4 text-gray-300">{row.trait}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="p-12 flex flex-col items-center justify-center text-center">
                                <div className="p-4 bg-white/5 rounded-full mb-4">
                                    <Icons.Search className="w-8 h-8 text-gray-500" />
                                </div>
                                <h3 className="text-lg font-bold text-white mb-2">No Variants Found</h3>
                                <p className="text-gray-400 max-w-sm">
                                    {data ? "Try a different search term." : "Upload your 23andMe file to browse your DNA."}
                                </p>
                            </div>
                        )}
                    </GlassCard>
                </div>
            );
        };

        // --- CORE DASHBOARD LOGIC ---
        const Dashboard = ({ data, onUpload }) => {
            const [dragActive, setDragActive] = React.useState(false);
            const [uploadState, setUploadState] = React.useState('idle');
            const [progress, setProgress] = React.useState(0);
            const [statusText, setStatusText] = React.useState('');

            // Initial Dummy Data
            const initialData = {
                vitality_score: 0,
                score_label: 'No Data',
                stats: { metab: '-', recovery: '-', cog: '-' },
                trait_stats: [],
                risk_list: []
            };

            const displayData = (data && (data.vitality_score !== undefined)) ? data : initialData;
            const hasData = !!(data && data.vitality_score > 0);

            // API Upload Handler
            const handleFileUpload = async (file) => {
                if (!file) return;
                setUploadState('analyzing');
                setProgress(10);
                setStatusText('Securely uploading file...');

                const formData = new FormData();
                formData.append("file", file);

                try {
                    // Use the LIVE Render Backend URL
                    const response = await fetch('https://my-blueprint.onrender.com/api/analyze', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) throw new Error("Analysis failed");

                    setProgress(60);
                    setStatusText('Processing Genomic Data...');

                    const result = await response.json();

                    setProgress(100);
                    setStatusText('Analysis Complete');

                    setTimeout(() => {
                        // TRANSFORM DATA
                        const transformedData = {
                            vitality_score: 84, // Mock score
                            score_label: 'Optimal',
                            stats: { metab: 'Fast', recovery: 'High', cog: 'Balanced' },
                            risk_list: result.health_flags || [],
                            trait_stats: result.future_perspectives || [],
                            genome_sample: result.genome_sample || [] // Capture Raw Data
                        };
                        onUpload(transformedData);
                        setUploadState('complete');
                        setTimeout(() => setUploadState('idle'), 3000);
                    }, 800);

                } catch (err) {
                    console.error(err);
                    setUploadState('error');
                    setStatusText('Error analyzing file. Ensure the server is running.');
                    setTimeout(() => setUploadState('idle'), 4000);
                }
            };

            const handleDrop = (e) => { e.preventDefault(); e.stopPropagation(); setDragActive(false); if (e.dataTransfer.files[0]) handleFileUpload(e.dataTransfer.files[0]); };
            const handleManualUpload = (e) => { if (e.target.files[0]) handleFileUpload(e.target.files[0]); };

            // PDF Generation Logic
            const handleExport = () => {
                if (!hasData) {
                    alert("Please upload data before exporting.");
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Add Title and Header
                doc.setFontSize(22);
                doc.setTextColor(20, 184, 166); // Teal Color
                doc.text("MyBlueprint - Genomic Analysis Report", 14, 22);

                doc.setFontSize(10);
                doc.setTextColor(100);
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 28);

                // Vitality Score Section
                doc.setFillColor(240, 253, 250); // Light teal bg
                doc.rect(14, 35, 182, 25, 'F');

                doc.setFontSize(16);
                doc.setTextColor(0);
                doc.text("Vitality Score", 20, 48);

                doc.setFontSize(24);
                doc.setTextColor(20, 184, 166);
                doc.text(`${displayData.vitality_score}`, 160, 48, { align: 'right' });

                doc.setFontSize(10);
                doc.setTextColor(100);
                doc.text(`(${displayData.score_label})`, 160, 54, { align: 'right' });

                // Prepare Data for Tables
                const riskData = (displayData.risk_list || []).map(item => [
                    item.variant || item.gene,
                    item.significance,
                    item.source
                ]);

                const traitData = (displayData.trait_stats || []).map(item => [
                    item.category,
                    item.value,
                    item.genotype
                ]);

                // Risks Table
                doc.setFontSize(14);
                doc.setTextColor(0);
                doc.text("Genetic Risks", 14, 75);

                doc.autoTable({
                    head: [['Variant / Gene', 'Risk Level', 'Source']],
                    body: riskData,
                    startY: 80,
                    theme: 'grid',
                    headStyles: { fillColor: [220, 38, 38], textColor: 255 }, // Red header for risks
                    styles: { fontSize: 10, cellPadding: 4 }
                });

                // Traits Table
                const finalY = doc.lastAutoTable.finalY + 15;
                doc.text("Traits & Perspectives", 14, finalY);

                doc.autoTable({
                    head: [['Category', 'Result', 'Genotype']],
                    body: traitData,
                    startY: finalY + 5,
                    theme: 'grid',
                    headStyles: { fillColor: [20, 184, 166], textColor: 255 }, // Teal header for traits
                    styles: { fontSize: 10, cellPadding: 4 }
                });

                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150);
                    doc.text('MyBlueprint Genomic Intelligence | Confidential', 14, doc.internal.pageSize.height - 10);
                    doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 25, doc.internal.pageSize.height - 10);
                }

                doc.save(`MyBlueprint_Report_${new Date().toISOString().split('T')[0]}.pdf`);
            };

            // Safe calculation for stroke offset
            const safeScore = hasData && !isNaN(displayData.vitality_score) ? displayData.vitality_score : 0;
            const strokeOffset = 552 - (552 * (safeScore / 100));

            return (
                <div className="p-4 lg:p-8 space-y-8 pb-20 mt-16 md:mt-0">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                        <div>
                            <h1 className="text-4xl font-bold text-white mb-2 tracking-tight">Genetic Overview</h1>
                            <p className="text-gray-400">Your biological data, decoded and simplified.</p>
                        </div>
                        <div className="flex gap-3">
                            <button
                                onClick={handleExport}
                                className="px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-xl border border-white/10 transition-all font-medium flex items-center"
                            >
                                <Icons.FileText className="w-4 h-4 mr-2 text-blueprint-400" />
                                Export Report
                            </button>
                            <label className="cursor-pointer px-6 py-2 bg-blueprint-500 hover:bg-blueprint-400 text-black font-bold rounded-xl shadow-[0_0_20px_rgba(20,184,166,0.4)] transition-all flex items-center">
                                <Icons.UploadCloud className="w-4 h-4 mr-2" />
                                Upload DNA
                                <input type="file" className="hidden" onChange={handleManualUpload} accept=".txt,.csv,.vcf" />
                            </label>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 auto-rows-[180px]">
                        {/* HERO WIDGET */}
                        <GlassCard className="col-span-1 md:col-span-2 row-span-2 relative flex flex-col justify-center items-center" subtitle="Overall Vitality">
                            <div className="relative z-10 flex flex-col items-center">
                                <div className="relative w-48 h-48 flex items-center justify-center">
                                    <svg className="w-full h-full transform -rotate-90 transition-all duration-1000">
                                        <circle cx="96" cy="96" r="88" stroke="currentColor" strokeWidth="12" fill="transparent" className="text-blueprint-900/50" />
                                        <circle cx="96" cy="96" r="88" stroke="currentColor" strokeWidth="12" fill="transparent" strokeDasharray="552" strokeDashoffset={strokeOffset} className="text-blueprint-400 drop-shadow-[0_0_10px_rgba(45,212,191,0.5)] transition-all duration-1000 ease-out" strokeLinecap="round" />
                                    </svg>
                                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                                        {uploadState === 'analyzing' ? (
                                            <div className="flex flex-col items-center animate-pulse"><Icons.Activity className="w-12 h-12 text-blueprint-300 mb-2" /><span className="text-sm font-medium text-blueprint-200">SCANNING</span></div>
                                        ) : (
                                            <>
                                                <span className="text-6xl font-bold text-white transition-all duration-500">{hasData ? displayData.vitality_score : '--'}</span>
                                                <span className="text-sm text-blueprint-300 uppercase tracking-widest mt-1">{hasData ? displayData.score_label : 'Upload Data'}</span>
                                            </>
                                        )}
                                    </div>
                                </div>
                                <div className="mt-8 flex gap-8">
                                    {hasData ? (displayData.trait_stats || []).map((stat, i) => (
                                        <div key={i} className="text-center px-2 border-r border-white/10 last:border-0">
                                            <p className="text-gray-400 text-xs uppercase">{stat.category}</p>
                                            <p className="text-white font-bold transition-all">{stat.value}</p>
                                        </div>
                                    )) : <div className="text-gray-500 text-sm">Waiting for genome file...</div>}
                                </div>
                            </div>
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-blueprint-500/20 blur-[100px] -z-0" />
                        </GlassCard>

                        {/* UPLOAD WIDGET */}
                        <div className={`relative col-span-1 md:col-span-2 row-span-1 rounded-2xl border transition-all duration-300 overflow-hidden group ${dragActive ? 'border-blueprint-400 bg-blueprint-500/10 shadow-[0_0_30px_rgba(45,212,191,0.2)]' : 'border-white/10 bg-white/[0.03] hover:border-white/20'}`}
                            onDragEnter={(e) => { e.preventDefault(); e.stopPropagation(); setDragActive(true) }} onDragLeave={(e) => { e.preventDefault(); e.stopPropagation(); setDragActive(false) }} onDragOver={(e) => { e.preventDefault(); e.stopPropagation(); setDragActive(true) }} onDrop={handleDrop}
                        >
                            {uploadState === 'idle' && (
                                <div className="h-full flex flex-col items-center justify-center text-center p-6 backdrop-blur-md">
                                    <label htmlFor="file-upload-widget" className="cursor-pointer flex flex-col items-center w-full h-full justify-center">
                                        <Icons.UploadCloud className={`w-8 h-8 mb-3 transition-transform duration-300 ${dragActive ? 'scale-110 text-blueprint-400' : 'text-gray-500 group-hover:text-blueprint-300'}`} />
                                        <p className="text-gray-300 font-medium">Drag & Drop 23andMe / VCF file</p>
                                        <p className="text-xs text-gray-500 mt-1">Supports .txt, .csv, .vcf</p>
                                        <input type="file" id="file-upload-widget" className="hidden" onChange={handleManualUpload} accept=".txt,.csv,.vcf" />
                                    </label>
                                </div>
                            )}
                            {uploadState === 'analyzing' && (
                                <div className="h-full flex flex-col items-center justify-center p-6 relative">
                                    <div className="absolute inset-0 bg-blueprint-900/80 backdrop-blur-sm z-0" />
                                    <div className="relative z-10 w-full max-w-sm">
                                        <div className="flex justify-between text-xs text-blueprint-300 mb-2 font-mono"><span>{statusText}</span><span>{progress}%</span></div>
                                        <div className="w-full h-2 bg-gray-700 rounded-full overflow-hidden"><div className="h-full bg-blueprint-400 shadow-[0_0_10px_#2dd4bf] transition-all duration-300 ease-out" style={{ width: `${progress}%` }} /></div>
                                        <div className="mt-4 dna-loader"></div>
                                    </div>
                                </div>
                            )}
                            {uploadState === 'complete' && (
                                <div className="h-full flex flex-col items-center justify-center p-6 bg-blueprint-500/10 border-blueprint-500/30">
                                    <div className="p-3 bg-blueprint-500/20 rounded-full mb-3 shadow-glow"><Icons.CheckCircle className="w-8 h-8 text-blueprint-400" /></div>
                                    <p className="text-white font-bold">Analysis Complete</p><p className="text-xs text-blueprint-200">Dashboard Updated</p>
                                </div>
                            )}
                            {uploadState === 'error' && (
                                <div className="h-full flex flex-col items-center justify-center p-6 bg-red-500/10 border-red-500/30">
                                    <div className="p-3 bg-red-500/20 rounded-full mb-3"><Icons.AlertTriangle className="w-8 h-8 text-red-400" /></div>
                                    <p className="text-white font-bold">Error</p><p className="text-xs text-red-200">{statusText}</p>
                                </div>
                            )}
                        </div>

                        {/* RISK WIDGET */}
                        <GlassCard className="col-span-1 row-span-2" title="Attention Required" subtitle="Genetic Risks">
                            <div className="space-y-4 mt-2">
                                {hasData ? (displayData.risk_list || []).map((item, i) => (
                                    <div key={i} className="group p-3 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 transition-colors cursor-pointer animate-[fadeIn_0.5s_ease-out]">
                                        <div className="flex justify-between items-center mb-1"><span className="text-sm font-medium text-gray-200">{item.source}</span><Icons.AlertTriangle className={`w-3 h-3 ${item.significance.includes('High') ? 'text-red-400' : 'text-yellow-400'}`} /></div>
                                        <div className="flex justify-between text-xs text-gray-500"><span>{item.variant.split('(')[0].substring(0, 15)}...</span><span className={`${item.significance.includes('High') ? 'text-red-300' : 'text-yellow-300'}`}>{item.significance}</span></div>
                                    </div>
                                )) : <div className="text-gray-500 text-center py-4 text-sm">No risks analyzed yet.</div>}
                                {hasData && <button className="w-full py-2 text-xs text-gray-400 hover:text-white flex items-center justify-center mt-2 group">View All Risks <Icons.ChevronRight className="w-3 h-3 ml-1 group-hover:translate-x-1 transition-transform" /></button>}
                            </div>
                        </GlassCard>

                        {/* TRAITS */}
                        {hasData ? (
                            <>
                                <GlassCard className="col-span-1" title="Muscle Type"><div className="flex items-center gap-4 mt-2"><div className="p-3 rounded-lg bg-orange-500/20 text-orange-400"><Icons.Activity className="w-6 h-6" /></div><div><p className="text-xl font-bold text-white">Power</p><p className="text-xs text-gray-400">ACTN3 (CC)</p></div></div></GlassCard>
                                <GlassCard className="col-span-1" title="Sleep Depth"><div className="flex items-center gap-4 mt-2"><div className="p-3 rounded-lg bg-purple-500/20 text-purple-400"><Icons.Brain className="w-6 h-6" /></div><div><p className="text-xl font-bold text-white">Deep</p><p className="text-xs text-gray-400">DEC2 (Normal)</p></div></div></GlassCard>
                                <GlassCard className="col-span-1" title="Heart Health"><div className="flex items-center gap-4 mt-2"><div className="p-3 rounded-lg bg-red-500/20 text-red-400"><Icons.HeartPulse className="w-6 h-6" /></div><div><p className="text-xl font-bold text-white">Normal</p><p className="text-xs text-gray-400">9p21 (Low Risk)</p></div></div></GlassCard>
                            </>
                        ) : (
                            <GlassCard className="col-span-1 md:col-span-3 flex items-center justify-center"><p className="text-gray-500">Upload a file to see trait details.</p></GlassCard>
                        )}
                    </div>
                </div>
            );
        };

        const PlaceholderView = ({ title }) => (<div className="p-8 h-full flex flex-col items-center justify-center text-center mt-16 md:mt-0"><div className="p-6 bg-white/5 rounded-full mb-6 animate-pulse"><Icons.Dna className="w-16 h-16 text-gray-600" /></div><h2 className="text-3xl font-bold text-white mb-2">{title}</h2><p className="text-gray-400 max-w-md">This module is under construction.</p></div>);

        // 5. App Wrapper
        const App = () => {
            const [activeTab, setActiveTab] = React.useState('overview');
            const [sidebarOpen, setSidebarOpen] = React.useState(false);
            // PERSISTENT STATE: Load from localStorage or null
            const [appData, setAppData] = React.useState(() => {
                const saved = localStorage.getItem('myBlueprintData');
                return saved ? JSON.parse(saved) : null;
            });

            const handleMainClick = () => { if (sidebarOpen) setSidebarOpen(false); };

            const handleDataUpdate = (newData) => {
                setAppData(newData);
                localStorage.setItem('myBlueprintData', JSON.stringify(newData)); // Save to browser
            };

            return (
                <div className="flex min-h-screen bg-blueprint-900 text-white font-sans selection:bg-blueprint-500 selection:text-white overflow-x-hidden">
                    <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden">
                        <div className="absolute top-[-10%] left-[-10%] w-[50vw] h-[50vw] bg-blueprint-500/5 rounded-full blur-[120px]" />
                        <div className="absolute bottom-[-10%] right-[-10%] w-[50vw] h-[50vw] bg-purple-900/10 rounded-full blur-[120px]" />
                    </div>
                    <MobileHeader onMenuClick={() => setSidebarOpen(true)} />
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} isOpen={sidebarOpen} setIsOpen={setSidebarOpen} />
                    <main onClick={handleMainClick} className={`flex-1 relative z-10 transition-[padding] duration-300 ease-in-out ${sidebarOpen ? 'md:pl-72' : 'md:pl-20'}`}>
                        <div className="container mx-auto max-w-7xl pt-4">
                            {activeTab === 'overview' && <Dashboard data={appData} onUpload={handleDataUpdate} />}
                            {activeTab === 'genome' && <GenomeBrowser data={appData} />}
                            {activeTab !== 'overview' && activeTab !== 'genome' && <PlaceholderView title={activeTab.charAt(0).toUpperCase() + activeTab.slice(1)} />}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>